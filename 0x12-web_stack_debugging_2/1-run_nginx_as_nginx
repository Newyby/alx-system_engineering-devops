#!/usr/bin/env bash

# Stop Nginx if it's already running as root
service nginx stop

# Backup the default Nginx configuration
cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.bak

# Replace root with nginx user in the Nginx configuration
sed -i 's/user\s*root;/user nginx;/g' /etc/nginx/nginx.conf

# Restart Nginx with the new configuration
service nginx start

# Ensure Nginx is set to start on boot
systemctl enable nginx

# Update the Nginx listening port to 8080
sed -i 's/listen\s*80;/listen 8080;/g' /etc/nginx/sites-available/default

# Restart Nginx to apply the port change
service nginx restart

